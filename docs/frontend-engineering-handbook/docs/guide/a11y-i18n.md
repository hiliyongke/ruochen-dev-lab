# 可访问性与国际化

## 本章目的
- 建立“设计/开发/测试/发布”环中的可访问性（a11y）与国际化（i18n）闭环
- 给出规则集、组件要点、工具链与 CI 集成的可复制方案

## 复制清单
- a11y 规则：eslint-plugin-jsx-a11y / eslint-plugin-vue-a11y（或 @vue/eslint-config-typescript + 自定义）
- 自动化检查：axe-core（浏览器/Playwright 集成）、Lighthouse a11y 分数门槛
- 组件要点：语义标签、焦点顺序、键盘可达、对比度、可读的 aria-label
- i18n 工具：i18next（React）、vue-i18n（Vue）、ICU 消息格式
- 流程：文案抽取/翻译/伪本地化/RTL，CI 校验与构件归档

## a11y 规则与检查
安装
```bash
pnpm add -D eslint-plugin-jsx-a11y axe-core
```
ESLint 片段（React）
```js
// .eslintrc.cjs
module.exports = {
  extends: ['plugin:jsx-a11y/recommended', 'prettier'],
  plugins: ['jsx-a11y']
};
```
Playwright 集成 axe（E2E 断言）
```ts
import { test, expect } from '@playwright/test';
import AxeBuilder from '@axe-core/playwright';

test('a11y baseline', async ({ page }) => {
  await page.goto('http://localhost:5173/');
  const results = await new AxeBuilder({ page }).analyze();
  expect(results.violations).toEqual([]);
});
```
Lighthouse a11y 门槛
```json
{
  "ci": { "assert": { "assertions": { "categories:accessibility": ["error", { "minScore": 0.9 }] } } }
}
```

## 组件与交互要点（速查）
- 语义结构：用 `<button>`/`<nav>`/`<main>`/`<label>` 等语义标签替代 div
- 焦点管理：Tab 顺序正确；模态打开时聚焦；关闭后返回触发源
- 键盘可达：Space/Enter/Arrow/ESC 行为与 WAI-ARIA 一致
- 对比度：文本对比度 ≥ 4.5:1；禁用仅颜色传达信息
- ARIA：仅在语义不足时补充；避免冗余/冲突的 aria 属性

## i18n 快速接入
安装（React 示例）
```bash
pnpm add i18next react-i18next
```
初始化
```ts
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
i18n.use(initReactI18next).init({
  resources: {
    en: { translation: { hello: 'Hello' } },
    zh: { translation: { hello: '你好' } }
  },
  lng: 'zh',
  fallbackLng: 'en',
  interpolation: { escapeValue: false }
});
```
使用
```tsx
import { useTranslation } from 'react-i18next';
function Hello() {
  const { t } = useTranslation();
  return <h1>{t('hello')}</h1>;
}
```

## 文案治理与伪本地化
- 抽取：统一在 src/locales/ 管理；禁写死字符串到组件
- 伪本地化：用扩展字符替换，检测截断/布局溢出
- RTL 支持：dir="rtl"、逻辑属性（margin-inline/start/end）

## 日期/数字与区域差异
- 使用 Intl.DateTimeFormat / Intl.NumberFormat；禁手写格式化
```ts
new Intl.NumberFormat('zh-CN', { style: 'currency', currency: 'CNY' }).format(1234.56);
```

## CI 集成（GitHub Actions）
.github/workflows/a11y-i18n.yml
```yml
name: A11y & i18n
on:
  pull_request:
  push: { branches: [main] }
jobs:
  a11y:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v4
        with: { version: 9 }
      - uses: actions/setup-node@v4
        with: { node-version: 20, cache: pnpm }
      - run: pnpm i --frozen-lockfile
      - run: pnpm build
      - run: pnpm dlx @lhci/cli autorun --config=lighthouserc.json
  e2e-axe:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v4
        with: { version: 9 }
      - uses: actions/setup-node@v4
        with: { node-version: 20, cache: pnpm }
      - run: pnpm i --frozen-lockfile
      - run: pnpm build
      - run: pnpm -w dlx serve dist -l 5173 & sleep 2
      - run: pnpm playwright test
```

## 度量与看板
- 指标：Lighthouse a11y 分数、axe 违规数、Top 违规类型、修复周期
- 可视化：CI 归档报告，拉红阈值与趋势对比

## 常见坑与 FAQ
- “ARIA 越多越好？”：先语义标签，ARIA 仅补充；错误的 aria 会适得其反
- “国际化只翻译字符串？”：考虑布局/长度/RTL 与日期数字格式
- “检查太慢？”：PR 跑关键页面与 E2E；主分支/夜间任务跑全量

## 参考链接
- WAI-ARIA: https://www.w3.org/WAI/standards-guidelines/aria/
- axe-core: https://github.com/dequelabs/axe-core
- react-i18next: https://react.i18next.com
- vue-i18n: https://vue-i18n.intlify.dev