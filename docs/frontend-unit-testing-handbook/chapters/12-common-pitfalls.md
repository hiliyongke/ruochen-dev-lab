# 常见坑与诊断思路

1) 测试不稳定（flaky）
- 根因：依赖时间/网络/并发共享状态
- 解法：fake timers/MSW/隔离状态与清理

2) 与实现过度耦合
- 症状：重构命名/结构即大面积失败
- 解法：切到「外部行为」断言；调整测试查询方式

3) 覆盖率焦虑
- 症状：追求 100% 导致大量无意义断言
- 解法：基于风险的覆盖策略，关注关键分支

4) 复杂组件难测
- 症状：内部状态多、副作用重
- 解法：拆分纯渲染与逻辑、注入依赖、提纯函数

Checklist：
- 用例是否只关心行为？是否可重复运行？
- 是否存在未清理的全局状态/计时器/DOM？
- 失败信息是否能快速定位？